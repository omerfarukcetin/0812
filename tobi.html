<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tobi'nin Havu√ß Macerasƒ± - v2</title>
    <style>
        :root {
            --primary: #FF9F1C;
            --secondary: #2EC4B6;
            --accent: #FF4040;
            --loop-color: #9C27B0;
            --bg: #E0F7FA;
            --dark: #011627;
            --grid-size: 70px; /* Kare boyutu */
        }

        body {
            font-family: 'Comic Sans MS', 'Chalkboard SE', sans-serif;
            background-color: var(--bg);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            user-select: none;
            overflow-x: hidden;
        }

        header {
            background-color: var(--secondary);
            color: white;
            width: 100%;
            text-align: center;
            padding: 15px;
            box-shadow: 0 6px 0 #1b8a7f;
            margin-bottom: 20px;
            position: relative;
            z-index: 20;
        }

        h1 { margin: 0; font-size: 1.8rem; text-shadow: 2px 2px 0 rgba(0,0,0,0.1); }
        .subtitle { font-size: 1rem; opacity: 0.9; margin-top: 5px; }

        /* Oyun Alanƒ± */
        #game-layout {
            display: flex;
            flex-direction: column; /* Mobilde alt alta */
            align-items: center;
            gap: 20px;
            width: 95%;
            max-width: 1000px;
        }

        /* Geni≈ü ekranlarda yan yana */
        @media (min-width: 800px) {
            #game-layout {
                flex-direction: row;
                align-items: flex-start;
                justify-content: center;
            }
        }

        /* Sol Taraf: Harita */
        .game-board-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .level-badge {
            background: var(--accent);
            color: white;
            padding: 8px 20px;
            border-radius: 30px;
            font-size: 1.2rem;
            font-weight: bold;
            box-shadow: 0 4px 0 #b32431;
            margin-bottom: 5px;
        }

        #grid {
            display: grid;
            grid-template-columns: repeat(5, var(--grid-size));
            grid-template-rows: repeat(5, var(--grid-size));
            gap: 6px;
            background-color: #81D4FA;
            padding: 12px;
            border-radius: 20px;
            border: 6px solid var(--dark);
            box-shadow: 12px 12px 0 rgba(0,0,0,0.15);
        }

        .cell {
            width: var(--grid-size);
            height: var(--grid-size);
            background-color: white;
            border-radius: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.5rem;
            position: relative;
            box-shadow: inset 0 -4px 0 rgba(0,0,0,0.1);
        }

        .cell.wall { 
            background-color: #546E7A; 
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3Eüß±%3C/text%3E%3C/svg%3E");
            background-size: 60%;
            background-position: center;
            background-repeat: no-repeat;
        }
        
        .player { 
            position: absolute; 
            transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1); /* Zƒ±plama efekti */
            z-index: 10;
            font-size: 3rem;
            filter: drop-shadow(0 5px 5px rgba(0,0,0,0.3));
        }
        
        .carrot { 
            z-index: 5; 
            font-size: 2.8rem;
            animation: float 2s infinite ease-in-out; 
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }

        /* Saƒü Taraf: Kontroller */
        .controls-section {
            background: white;
            padding: 20px;
            border-radius: 20px;
            border: 4px solid var(--dark);
            width: 100%;
            max-width: 450px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
        }

        #algorithm-display {
            min-height: 70px;
            background: #F5F5F5;
            border-radius: 15px;
            padding: 10px;
            margin-bottom: 20px;
            border: 2px dashed #ccc;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
            align-content: flex-start;
        }

        .code-block {
            background: var(--primary);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: bold;
            display: flex;
            align-items: center;
            box-shadow: 0 4px 0 #c27815;
            font-size: 1.3rem;
            animation: popIn 0.3s;
            cursor: pointer;
        }
        
        .code-block:hover { transform: scale(1.05); }

        .code-block.loop {
            background: var(--loop-color);
            box-shadow: 0 4px 0 #6a1b9a;
            border: 2px solid white;
        }

        /* Buton Gruplarƒ± */
        .btn-group-arrows {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        button {
            border: none;
            border-radius: 15px;
            padding: 15px 5px;
            font-size: 2.5rem; /* ƒ∞kon boyutu */
            cursor: pointer;
            transition: transform 0.1s, background 0.2s;
            font-family: inherit;
            color: white;
            font-weight: bold;
            position: relative;
            touch-action: manipulation;
        }

        button:active { transform: translateY(6px); box-shadow: none !important; }

        .btn-move { 
            background: var(--secondary); 
            box-shadow: 0 8px 0 #1b8a7f; 
            height: 80px;
        }
        
        /* D-Pad D√ºzeni */
        .spacer { visibility: hidden; }

        .btn-action-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .btn-run { 
            background: #4CAF50; 
            box-shadow: 0 8px 0 #2E7D32; 
            font-size: 1.5rem;
            grid-column: span 2;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        .btn-reset { 
            background: #FF5252; 
            box-shadow: 0 6px 0 #b71c1c; 
            font-size: 1.2rem;
        }

        .btn-loop {
            background: var(--loop-color);
            box-shadow: 0 6px 0 #4a148c;
            font-size: 1.2rem;
            display: none; /* JS ile a√ßƒ±lacak */
        }

        /* Modal */
        #modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            display: none;
            justify-content: center; align-items: center;
            z-index: 100;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            max-width: 90%;
            animation: bounceIn 0.6s;
            border: 5px solid var(--secondary);
        }

        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Konfeti */
        .confetti {
            position: fixed;
            width: 15px; height: 15px;
            background-color: #f00;
            animation: confetti-fall 3s linear forwards;
            z-index: 999;
        }
        @keyframes confetti-fall {
            0% { transform: translateY(-10vh) rotate(0deg); }
            100% { transform: translateY(110vh) rotate(720deg); }
        }

        /* Loop Modalƒ± */
        .loop-controls {
            display: flex; justify-content: center; align-items: center; gap: 15px; 
            margin: 20px 0; background: #f3e5f5; padding: 15px; border-radius: 15px;
        }
        select { font-size: 1.5rem; padding: 10px; border-radius: 10px; border: 2px solid var(--loop-color); }

        @media (max-width: 500px) {
            :root { --grid-size: 60px; }
            .btn-move { height: 70px; font-size: 2rem; }
            h1 { font-size: 1.4rem; }
        }
    </style>
</head>
<body>

<header>
    <h1>üê∞ Tobi'nin Havu√ß Macerasƒ±</h1>
    <div class="subtitle">1. Sƒ±nƒ±f Kodlama At√∂lyesi</div>
</header>

<div id="game-layout">
    <!-- SOL: Oyun Sahnesi -->
    <div class="game-board-section">
        <div class="level-badge" id="level-display">Seviye 1</div>
        <div id="grid">
            <!-- JS ile dolacak -->
        </div>
        <div id="message-area" style="font-size:1.1rem; color:var(--dark); text-align:center; max-width:350px;">
            Komutlarƒ± kullanarak tav≈üanƒ± havuca g√∂t√ºr!
        </div>
    </div>

    <!-- SAƒû: B√ºy√ºk Kontroller -->
    <div class="controls-section">
        <div style="font-size: 0.9rem; color: #666; margin-bottom:5px;">Yazdƒ±ƒüƒ±n Kodlar:</div>
        <div id="algorithm-display">
            <span style="color:#aaa; font-style:italic; font-size:0.9rem;">Hen√ºz komut yok...</span>
        </div>
        
        <!-- Y√∂n Tu≈ülarƒ± (D-Pad benzeri yerle≈üim) -->
        <div class="btn-group-arrows">
            <div class="spacer"></div>
            <button class="btn-move" onclick="addCommand('up')">‚¨ÜÔ∏è</button>
            <div class="spacer"></div>
            
            <button class="btn-move" onclick="addCommand('left')">‚¨ÖÔ∏è</button>
            <button class="btn-move" onclick="addCommand('down')">‚¨áÔ∏è</button>
            <button class="btn-move" onclick="addCommand('right')">‚û°Ô∏è</button>
        </div>

        <div class="btn-action-group">
            <button class="btn-loop" id="loop-btn" onclick="openLoopModal()">üîÑ TEKRARLA (D√∂ng√º)</button>
            <button class="btn-reset" onclick="resetLevel()">üóëÔ∏è Sƒ∞L</button>
            <button class="btn-run" onclick="runAlgorithm()">‚ñ∂Ô∏è BA≈ûLAT</button>
        </div>
    </div>
</div>

<!-- Kazandƒ±n Modalƒ± -->
<div id="modal">
    <div class="modal-content">
        <h1 style="font-size: 3rem; margin:10px;">üéâ</h1>
        <h2 id="modal-title">Harikasƒ±n!</h2>
        <p id="modal-msg" style="margin-bottom:20px;">Havuca ula≈ütƒ±n!</p>
        <button class="btn-move" style="width:100%; background:var(--primary); box-shadow:0 8px 0 #c27815;" onclick="nextLevel()">Sonraki Seviye ‚û°Ô∏è</button>
    </div>
</div>

<!-- Loop Se√ßim Modalƒ± -->
<div id="loop-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:150; justify-content:center; align-items:center;">
    <div style="background:white; padding:25px; border-radius:25px; width: 90%; max-width:350px; text-align:center; box-shadow:0 10px 25px rgba(0,0,0,0.2);">
        <h3 style="color:var(--loop-color); margin-top:0;">D√∂ng√º Bloƒüu</h3>
        <p>Hangi hareketi ka√ß kere yapalƒ±m?</p>
        
        <div class="loop-controls">
            <select id="loop-dir">
                <option value="right">‚û°Ô∏è Saƒü</option>
                <option value="left">‚¨ÖÔ∏è Sol</option>
                <option value="up">‚¨ÜÔ∏è Yukarƒ±</option>
                <option value="down">‚¨áÔ∏è A≈üaƒüƒ±</option>
            </select>
            <span style="font-size:1.5rem; font-weight:bold;">X</span>
            <select id="loop-count">
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
            </select>
        </div>
        
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
            <button onclick="document.getElementById('loop-modal').style.display='none'" style="background:#ccc; box-shadow:0 5px 0 #999; font-size:1rem;">ƒ∞ptal</button>
            <button onclick="addLoop()" style="background:var(--loop-color); box-shadow:0 5px 0 #4a148c; font-size:1rem;">Ekle</button>
        </div>
    </div>
</div>

<script>
    // Oyun Durumu
    const GRID_SIZE = 5;
    let currentLevel = 0;
    let commands = [];
    let playerPos = { x: 0, y: 0 };
    let isRunning = false;

    // Seviye Tasarƒ±mlarƒ± (8 Seviye)
    const levels = [
        {
            map: [
                ['S', 'E', 'E', 'G', 'E'],
                ['E', 'E', 'E', 'E', 'E'],
                ['E', 'E', 'E', 'E', 'E'],
                ['E', 'E', 'E', 'E', 'E'],
                ['E', 'E', 'E', 'E', 'E']
            ],
            msg: "Ba≈ülangƒ±√ß: Tav≈üanƒ± havuca g√∂t√ºrmek i√ßin SAƒû okuna bas.",
            allowLoop: false
        },
        {
            map: [
                ['S', 'E', 'E', 'E', 'E'],
                ['W', 'W', 'W', 'E', 'E'],
                ['E', 'E', 'E', 'E', 'E'],
                ['E', 'W', 'W', 'W', 'W'],
                ['G', 'E', 'E', 'E', 'E']
            ],
            msg: "Seviye 2: Duvarlara dikkat et! A≈üaƒüƒ± in, sonra sola d√∂n.",
            allowLoop: false
        },
        {
            map: [
                ['S', 'E', 'E', 'E', 'E'],
                ['E', 'W', 'W', 'W', 'E'],
                ['E', 'W', 'G', 'W', 'E'],
                ['E', 'W', 'E', 'E', 'E'],
                ['E', 'E', 'E', 'E', 'E']
            ],
            msg: "Seviye 3: Bir U harfi √ßizerek dola≈üman gerek.",
            allowLoop: false
        },
        {
            map: [
                ['S', 'E', 'E', 'E', 'E'],
                ['E', 'E', 'E', 'E', 'E'],
                ['E', 'E', 'E', 'E', 'E'],
                ['E', 'E', 'E', 'E', 'E'],
                ['E', 'E', 'E', 'E', 'G']
            ],
            msg: "Seviye 4: Yol √ßok uzun! Mor renkli TEKRAR (D√∂ng√º) tu≈üunu kullan.",
            allowLoop: true
        },
        {
             map: [
                ['S', 'E', 'E', 'E', 'W'],
                ['W', 'W', 'W', 'E', 'W'],
                ['G', 'E', 'E', 'E', 'W'],
                ['W', 'W', 'W', 'W', 'W'],
                ['E', 'E', 'E', 'E', 'E']
            ],
            msg: "Seviye 5: √ñnce a≈üaƒüƒ±, sonra sola git. D√∂ng√ºleri kullanabilirsin.",
            allowLoop: true
        },
        {
            map: [
                ['S', 'W', 'G', 'E', 'E'],
                ['E', 'W', 'E', 'W', 'E'],
                ['E', 'W', 'E', 'W', 'E'],
                ['E', 'W', 'E', 'W', 'E'],
                ['E', 'E', 'E', 'W', 'E']
            ],
            msg: "Seviye 6: Bir t√ºnelden ge√ßiyoruz! A≈üaƒüƒ± in, saƒüa ge√ß, yukarƒ± √ßƒ±k.",
            allowLoop: true
        },
        {
            map: [
                ['S', 'E', 'E', 'E', 'E'],
                ['E', 'W', 'W', 'W', 'W'],
                ['E', 'E', 'E', 'E', 'E'],
                ['W', 'W', 'W', 'W', 'E'],
                ['G', 'E', 'E', 'E', 'E']
            ],
            msg: "Seviye 7: Zikzak √ßizme zamanƒ±! (Yƒ±lan gibi kƒ±vrƒ±l)",
            allowLoop: true
        },
        {
            map: [
                ['W', 'W', 'W', 'W', 'W'],
                ['W', 'G', 'E', 'E', 'S'],
                ['W', 'W', 'W', 'W', 'E'],
                ['E', 'E', 'E', 'E', 'E'],
                ['E', 'W', 'W', 'W', 'W']
            ],
            msg: "Final B√∂l√ºm√º: Labirentten √ßƒ±kƒ±≈ü yolunu bul!",
            allowLoop: true
        }
    ];

    function initGame() {
        loadLevel(0);
    }

    function loadLevel(lvlIndex) {
        currentLevel = lvlIndex;
        commands = [];
        isRunning = false;
        
        // UI G√ºncelle
        document.getElementById('level-display').innerText = `Seviye ${lvlIndex + 1}`;
        document.getElementById('message-area').innerText = levels[lvlIndex].msg;
        
        // Loop butonunu g√∂ster/gizle
        const loopBtn = document.getElementById('loop-btn');
        if (levels[lvlIndex].allowLoop) {
            loopBtn.style.display = 'block';
            loopBtn.parentElement.style.gridTemplateColumns = '1fr 1fr'; // Grid d√ºzelt
        } else {
            loopBtn.style.display = 'none';
        }

        updateAlgorithmDisplay();
        drawGrid();
        resetPosition();
    }

    function drawGrid() {
        const gridEl = document.getElementById('grid');
        gridEl.innerHTML = '';
        const map = levels[currentLevel].map;

        for (let y = 0; y < GRID_SIZE; y++) {
            for (let x = 0; x < GRID_SIZE; x++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.id = `cell-${x}-${y}`;

                if (map[y][x] === 'W') {
                    cell.classList.add('wall');
                } else if (map[y][x] === 'G') {
                    cell.innerHTML = '<div class="carrot">ü•ï</div>';
                }

                gridEl.appendChild(cell);
            }
        }
    }

    function resetPosition() {
        const oldPlayer = document.querySelector('.player');
        if (oldPlayer) oldPlayer.remove();

        const map = levels[currentLevel].map;
        for (let y = 0; y < GRID_SIZE; y++) {
            for (let x = 0; x < GRID_SIZE; x++) {
                if (map[y][x] === 'S') {
                    playerPos = { x, y };
                }
            }
        }
        placePlayer(playerPos.x, playerPos.y);
    }

    function placePlayer(x, y) {
        const cell = document.getElementById(`cell-${x}-${y}`);
        const existing = document.querySelector('.player');
        if(existing) existing.remove();

        const playerDiv = document.createElement('div');
        playerDiv.className = 'player';
        playerDiv.innerText = 'üê∞';
        cell.appendChild(playerDiv);
    }

    // Komut Fonksiyonlarƒ±
    function addCommand(cmd) {
        if(isRunning) return;
        commands.push({type: 'move', val: cmd});
        updateAlgorithmDisplay();
    }

    function openLoopModal() {
        if(isRunning) return;
        document.getElementById('loop-modal').style.display = 'flex';
    }

    function addLoop() {
        const dir = document.getElementById('loop-dir').value;
        const count = parseInt(document.getElementById('loop-count').value);
        commands.push({type: 'loop', val: dir, count: count});
        document.getElementById('loop-modal').style.display = 'none';
        updateAlgorithmDisplay();
    }

    function resetLevel() {
        if(isRunning) return;
        commands = [];
        updateAlgorithmDisplay();
        resetPosition();
    }

    function updateAlgorithmDisplay() {
        const display = document.getElementById('algorithm-display');
        display.innerHTML = '';
        
        if (commands.length === 0) {
            display.innerHTML = '<span style="color:#aaa; font-style:italic; font-size:0.9rem;">Hen√ºz komut yok...</span>';
            return;
        }

        commands.forEach((cmd, index) => {
            const block = document.createElement('div');
            block.className = 'code-block';
            
            let symbol = '';
            if(cmd.val === 'up') symbol = '‚¨ÜÔ∏è';
            if(cmd.val === 'down') symbol = '‚¨áÔ∏è';
            if(cmd.val === 'left') symbol = '‚¨ÖÔ∏è';
            if(cmd.val === 'right') symbol = '‚û°Ô∏è';

            if(cmd.type === 'loop') {
                block.classList.add('loop');
                block.innerHTML = `üîÑ ${cmd.count}x ${symbol}`;
            } else {
                block.innerHTML = symbol;
            }
            
            block.onclick = () => {
                if(!isRunning) {
                    commands.splice(index, 1);
                    updateAlgorithmDisplay();
                }
            };
            display.appendChild(block);
        });
    }

    // √áalƒ±≈ütƒ±rma Mantƒ±ƒüƒ±
    async function runAlgorithm() {
        if (isRunning || commands.length === 0) return;
        isRunning = true;
        resetPosition();
        
        // Komutlarƒ± a√ß
        let executionQueue = [];
        commands.forEach(cmd => {
            if(cmd.type === 'move') executionQueue.push(cmd.val);
            else if (cmd.type === 'loop') {
                for(let i=0; i<cmd.count; i++) executionQueue.push(cmd.val);
            }
        });

        // Adƒ±m adƒ±m i≈üle
        for (let move of executionQueue) {
            await new Promise(r => setTimeout(r, 600)); // Tav≈üan hƒ±zƒ±
            if (!movePlayer(move)) {
                failLevel();
                return;
            }
        }

        checkWin();
        isRunning = false;
    }

    function movePlayer(dir) {
        let newX = playerPos.x;
        let newY = playerPos.y;

        if (dir === 'up') newY--;
        if (dir === 'down') newY++;
        if (dir === 'left') newX--;
        if (dir === 'right') newX++;

        if (newX < 0 || newX >= GRID_SIZE || newY < 0 || newY >= GRID_SIZE) return false;
        
        const map = levels[currentLevel].map;
        if (map[newY][newX] === 'W') return false;

        playerPos = { x: newX, y: newY };
        placePlayer(newX, newY);
        return true;
    }

    function checkWin() {
        const map = levels[currentLevel].map;
        if (map[playerPos.y][playerPos.x] === 'G') {
            triggerConfetti();
            document.getElementById('modal-title').innerText = "Harikasƒ±n!";
            document.getElementById('modal-msg').innerText = "Havuca ula≈ütƒ±n!";
            
            const btn = document.querySelector('#modal button');
            if(currentLevel === levels.length - 1) {
                document.getElementById('modal-msg').innerText = "T√ºm b√∂l√ºmleri bitirdin! Kodlama ustasƒ± oldun!";
                btn.innerText = "Tekrar Oyna üîÑ";
                btn.onclick = () => {
                     document.getElementById('modal').style.display = 'none';
                     initGame();
                };
            } else {
                btn.innerText = "Sonraki Seviye ‚û°Ô∏è";
                btn.onclick = nextLevel;
            }
            
            setTimeout(() => {
                document.getElementById('modal').style.display = 'flex';
            }, 500);
            
        } else {
            failLevel("Havu√ß orada deƒüil!");
        }
    }

    function failLevel(msg = "Eyvah! Tav≈üan yoruldu.") {
        document.getElementById('modal-title').innerText = "Dene Bakalƒ±m!";
        document.getElementById('modal-msg').innerText = msg;
        const btn = document.querySelector('#modal button');
        btn.innerText = "Tekrar Dene üîÑ";
        btn.style.background = "#FF5252";
        btn.onclick = () => {
            document.getElementById('modal').style.display = 'none';
            resetPosition();
            isRunning = false;
        };
        document.getElementById('modal').style.display = 'flex';
    }

    function nextLevel() {
        document.getElementById('modal').style.display = 'none';
        if (currentLevel < levels.length - 1) {
            loadLevel(currentLevel + 1);
        }
    }
    
    // Konfeti Efekti
    function triggerConfetti() {
        const colors = ['#f44336', '#e91e63', '#9c27b0', '#673ab7', '#3f51b5', '#2196f3', '#03a9f4', '#00bcd4', '#009688', '#4caf50', '#8bc34a', '#cddc39', '#ffeb3b', '#ffc107', '#ff9800', '#ff5722'];
        
        for (let i = 0; i < 50; i++) {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            confetti.style.left = Math.random() * 100 + 'vw';
            confetti.style.animationDuration = (Math.random() * 3 + 2) + 's';
            confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            document.body.appendChild(confetti);
            
            setTimeout(() => confetti.remove(), 5000);
        }
    }

    window.onload = initGame;

</script>

</body>
</html>
